JXLParseContext* ctx
*ctx = s->priv_data
if (!ctx->pc.index)
if ((!ctx->container || !ctx->codestream_length) && !ctx->next)
int ret
ret = try_parse(s, avctx, ctx, ctx->pc.buffer, ctx->pc.index)
if (ret < 0)
ctx->next = ret
if (ctx->container)
ctx->skip += ctx->next
if (ctx->container && ctx->next >= 0)

if (ctx->skip > buf_size)
buf += ctx->skip
buf_size -= ctx->skip
GetByteContext gb
bytestream2_init(&gb, buf, buf_size)
int head_size
head_size = 4
if (bytestream2_peek_le16(&gb) == FF_JPEGXL_CODESTREAM_SIGNATURE_LE)
if (bytestream2_peek_le64(&gb) == FF_JPEGXL_CONTAINER_SIGNATURE_LE)
if (bytestream2_get_bytes_left(&gb) < 8)
uint64_t size
size = bytestream2_get_be32(&gb)
if (size == 1)
if (bytestream2_get_bytes_left(&gb) < 12)
size = bytestream2_get_be64(&gb)
head_size = 12
if (!size)
if (size <= head_size + 4 || size > INT_MAX - ctx->skip)
ctx->skip += size
bytestream2_skip(&gb, size - head_size)
if (bytestream2_get_bytes_left(&gb) <= 0)
skip_boxes(ctx, ctx->pc.buffer, ctx->pc.index)