PyObject* new_memo
*new_memo = PyDict_New()
if (new_memo == NULL)
PyMemoTable* memo
memo = self->pickler->memo
Py_ssize_t i
for (i = 0;i < memo->mt_allocated;++i)
PyMemoEntry entry
entry = memo->mt_table[i]
if (entry.me_key != NULL)
PyObject* key
key = PyLong_FromVoidPtr(entry.me_key)
PyObject* value
value = Py_BuildValue("nO", entry.me_value, entry.me_key)
if (key == NULL || value == NULL)
int status
status = PyDict_SetItem(new_memo, key, value) *
if (status < 0)