struct bt_gatt_server* server
*server = user_data
uint16_t handle
handle = 0
if (length < 2)
authorize_req(server, opcode, handle)
uint8_t ecode
if (ecode)
handle = get_le16(pdu)
struct gatt_db_attribute* attr
attr = gatt_db_get_attribute(server->db, handle)
if (!attr)
util_debug(server->debug_callback, server->debug_data,
				"Write %s - handle: 0x%04x",
				(opcode == BT_ATT_OP_WRITE_REQ) ? "Req" : "Cmd",
				handle)
if (ecode)

uint32_t perm
perm = gatt_db_attribute_get_permissions(attr)
if (perm && mask & BT_ATT_PERM_READ && !(perm & BT_ATT_PERM_READ))
if (perm && mask & BT_ATT_PERM_WRITE && !(perm & BT_ATT_PERM_WRITE))
perm &= mask
if (!perm)
int security
uint8_t enc_size
security = bt_att_get_security(server->att, &enc_size)
if (security < 0)
if (perm & BT_ATT_PERM_SECURE)
if (security < BT_ATT_SECURITY_FIPS)
if (!check_min_key_size(server->min_enc_size, enc_size))
if (perm & BT_ATT_PERM_AUTHEN)
if (security < BT_ATT_SECURITY_HIGH)
if (!check_min_key_size(server->min_enc_size, enc_size))
if (perm & BT_ATT_PERM_ENCRYPT)
if (security < BT_ATT_SECURITY_MEDIUM)
check_min_key_size(server->min_enc_size, enc_size)
check_permissions(server, attr, BT_ATT_PERM_WRITE_MASK)